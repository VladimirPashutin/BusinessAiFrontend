<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <title>Инциденты с негативными отзывами - AI Бизнес помощник</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/autosize@4.0.2/dist/autosize.min.js"></script>
</head>

<body>
    <!-- Include Header -->
    {% include 'header.html' %}

    <!-- Main Content -->
    <main>
        <div class="container">
            <h2>Инциденты с негативными отзывами</h2>
            <p><a href="{{ url_for('review_routes.review_issues') }}" class="btn">Обновить список инцидентов</a></p>

            <div class="review-issue-list">
                {% for review_issue in review_issues %}
                <div class="review-issue-item">
                    <form method="POST" action="{{ url_for('review_routes.update_review_issue', id=review_issue.id) }}">
                        <input type="hidden" name="id" value="{{ review_issue.id }}">
                        <p>
                            <label for="review_rate_{{ review_issue.id }}">Оценка:</label>
                            <input type="number" id="review_rate_{{ review_issue.id }}" name="review_rate"
                                value="{{ review_issue.review_rate }}" required>
                        </p>
                        <p>
                            <label for="review_text_{{ review_issue.id }}">Текст отзыва:</label>
                            <textarea id="review_text_{{ review_issue.id }}" name="review_text" rows="4"
                                required>{{ review_issue.review_text }}</textarea>
                        </p>
                        <p>
                            <label for="company_story_{{ review_issue.id }}">История компании:</label>
                            <textarea id="company_story_{{ review_issue.id }}" name="company_story" rows="4"
                                required>{{ review_issue.company_story }}</textarea>
                        </p>
                        <p>
                            <label for="company_response_{{ review_issue.id }}">Ответ компании:</label>
                            <textarea id="company_response_{{ review_issue.id }}" name="company_response"
                                rows="4">{{ review_issue.company_response }}</textarea>
                        </p>
                        <p>
                            <button type="button" id="generateResponseBtn_{{ review_issue.id }}"
                                onclick="generateIssueResponse('{{ review_issue.id }}')" class="btn">Сгенерировать
                                ответ</button>
                        </p>
                        <p>
                            <label for="status_{{ review_issue.id }}">Статус:</label>
                            <select id="status_{{ review_issue.id }}" name="status" required>
                                <option value="draft" {% if review_issue.status=='draft' %}selected{% endif %}>Черновик
                                </option>
                                <option value="published" {% if review_issue.status=='published' %}selected{% endif %}>
                                    Опубликовано</option>
                                <option value="resolved" {% if review_issue.status=='resolved' %}selected{% endif %}>
                                    Решено</option>
                            </select>
                        </p>
                        <p>
                            <button type="submit" class="btn">Сохранить изменения</button>
                        </p>
                    </form>
                    <form method="POST" action="{{ url_for('review_routes.delete_review_issue', id=review_issue.id) }}">
                        <p>
                            <button type="submit" class="btn btn-danger">Удалить</button>
                        </p>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='scripts/control_posts.js') }}"></script>
    <script>
        autosize(document.querySelectorAll('textarea'));
    </script>
</body>

</html>